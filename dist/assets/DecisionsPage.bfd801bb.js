var Ce=Object.defineProperty,we=Object.defineProperties;var Te=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var Z=(e,i,n)=>i in e?Ce(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n,D=(e,i)=>{for(var n in i||(i={}))Me.call(i,n)&&Z(e,n,i[n]);if(X)for(var n of X(i))Be.call(i,n)&&Z(e,n,i[n]);return e},v=(e,i)=>we(e,Te(i));import{bl as We,N as I,O as h,as as W,bH as f,m as N,E as ne,r as g,a6 as T,a as d,B as m,j as t,I as R,aw as oe,ag as F,ah as M,ax as E,T as B,ay as se,bv as ee,k as Q,l as V,n as H,a1 as _,aX as A,F as y,a7 as re,b as Pe,bI as ke,P as ze,bx as Ne,by as Re,a$ as Ee,aL as q,Q as Oe,g as z,d as _e,ac as ae,bB as le,v as ce,o as O,p as de,bC as ue,M as j,a3 as he,af as G,s as $e,bJ as Ae,aA as me,aB as Le,aC as ge,aN as Fe,bK as Qe,aY as Ve,R as He,bL as qe,au as je,aZ as Ge,bM as k,aW as Je}from"./index.5f659e0f.js";import{s as Ye}from"./siteTitles.45ed3843.js";import{d as fe}from"./Edit.aa6ffe9d.js";import{p as be,a as pe,b as w,f as $,T as Ke,c as Ue}from"./immer.esm.c98d80d7.js";import{c as De}from"./colors.f3739cc4.js";import{c as te}from"./index.926ca9c5.js";import{M as Xe}from"./MySidebar.fc723cf4.js";const Ze=e=>!(!e||!Number(e)),et=h.BigDecisions.decision;function J(){return We(et,()=>I.get(h.BigDecisions.decision).then(e=>e.data))}const tt=e=>({id:null,userId:null,decisionId:e,title:"",index:null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});function C(e){return e.filter(i=>i.weight>=3).reduce((i,n)=>i+n.weight,0)}const L=e=>{const i=e.map(s=>C(s.items)),n=Math.min.apply(null,i),o=e.filter(s=>C(s.items)===n);if(o.length>1)return null;if(o.length===1)return o[0]};function it(){return W(e=>I.delete(h.BigDecisions.decision+"/"+e).then(i=>i.data),{onSuccess:(e,i)=>{const o=f.getQueryData(h.BigDecisions.decision).filter(s=>s.id!==i);f.setQueryData(h.BigDecisions.decision,o)}})}function xe(e){const i=nt(),[n,o]=g.exports.useState(null),s=a=>{o(a.currentTarget)},l=()=>{o(null)},r=it(),{openDecisionDialog:u,openConfirmDialog:c}=T();return d(m,{children:[t(R,{id:"decision-more-icon",size:"small","aria-label":"decision-more-icon",onClick:a=>{a.preventDefault(),s(a)},children:t(oe,{})}),d(F,{id:"decision-more-menu",anchorEl:n,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,open:Boolean(n),onClose:a=>{l()},children:[d(M,{onClick:a=>{a.preventDefault(),u(e.decision),l()},children:[t(E,{className:i.listItemIcon,children:t(fe,{fontSize:"small"})}),t(B,{variant:"inherit",noWrap:!0,children:"Edit"})]}),d(M,{onClick:a=>{a.preventDefault(),c({title:"Delete decision?",onConfirm:()=>{r.mutate(e.decision.id,{onSuccess:()=>{}})}})},id:"delete-decision-button",children:[t(E,{className:i.listItemIcon,children:t(se,{fontSize:"small",color:"error"})}),t(B,{variant:"inherit",noWrap:!0,color:"error",children:"Delete"})]})]})]})}const nt=N(e=>ne({listItemIcon:{width:16}}));function ot(e){return W(i=>I.post(h.BigDecisions.decisionTableItem,i).then(n=>n.data),{onSuccess:(i,n)=>{const o=f.getQueryData(h.BigDecisions.decision),s=be(o,l=>{const r=l.findIndex(a=>a.id===e),u=l[r].tables.findIndex(a=>a.id===i.decisionTableId),c=l[r].tables[u].items.findIndex(a=>a.id===i.id);i.updatedAt=n.updatedAt,~c?l[r].tables[u].items[c]=i:l[r].tables[u].items.push(i)});f.setQueryData(h.BigDecisions.decision,s)}})}const st=e=>({id:null,userId:null,decisionTableId:e,index:null,problem:"",solution:"",weight:1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),rt=e=>{const i=at(),[n,o]=g.exports.useState(e.initialItem),s=g.exports.useRef(),l=g.exports.useRef(),r=g.exports.useRef(),u=()=>s.current.focus(),c=()=>l.current.focus(),a=()=>r.current.select(),[b,x]=g.exports.useState(null),S=p=>{o(p),clearTimeout(b),x(setTimeout(()=>{e.onThrottledChange(p)},250))};return d(pe,{children:[t(w,{className:i.textareaCell,width:e.biggerColsWidth,onClick:u,children:t(ee,{ref:s,onChange:p=>S(v(D({},n),{problem:p.target.value})),value:n.problem,className:i.textarea})}),t(w,{className:i.textareaCell,width:e.biggerColsWidth,onClick:c,children:t(ee,{onChange:p=>S(v(D({},n),{solution:p.target.value})),value:n.solution,className:i.textarea,ref:l})}),t(w,{className:te(i.textareaCell,i.col3),onClick:a,children:t("input",{ref:r,className:te(i.textarea,{[i.bold]:n.weight>=3}),style:{textAlign:"center"},type:"number",min:"1",max:"5",value:n.weight?n.weight:"",onChange:p=>{const P=Number(p.target.value);P<1?S(v(D({},n),{weight:1})):P>5?S(v(D({},n),{weight:5})):P>=1&&P<=5&&S(v(D({},n),{weight:P}))}})})]},e.initialItem.id)},at=N(e=>({textareaCell:{cursor:"pointer !important"},td:{fontSize:13},textarea:{resize:"none",border:"none",width:"-webkit-fill-available",background:"none",fontSize:13,fontFamily:e.typography.fontFamily,color:"white",cursor:"pointer"},bold:{fontWeight:"bold",color:De.ratingYellow[5]},col3:{width:60,textAlign:"center"}}));var Y={},lt=V.exports,ct=H.exports;Object.defineProperty(Y,"__esModule",{value:!0});var Se=Y.default=void 0,dt=ct(g.exports),ut=lt(Q),ht=(0,ut.default)(dt.createElement("path",{d:"M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"}),"Sort");Se=Y.default=ht;function mt(){const{setErrorMessage:e}=_();return W(i=>I.post(h.BigDecisions.sortProblemsByWeight,i).then(n=>n.data),{onSuccess:i=>{const n=f.getQueryData(h.BigDecisions.decision),o=$(n,s=>{const l=n.findIndex(r=>r.id===i.id);return s[l]=i,s});f.setQueryData(h.BigDecisions.decision,o)},onError:i=>{e("Error while ordering table: "+JSON.stringify(i))}})}function gt(e){const[i,n]=g.exports.useState(null),o=r=>{n(r.currentTarget)},s=()=>{n(null)},l=mt();return d(m,{children:[t(R,{id:"sort-problems-weight-icon",size:"small","aria-label":"sort-problems-weight-icon",onClick:r=>{r.preventDefault(),o(r)},children:t(Se,{})}),d(F,{id:"sort-problems-weight-menu",anchorEl:i,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,open:Boolean(i),onClose:r=>{s()},children:[t(M,{onClick:()=>{l.mutate({tableId:e.table.id,order:"asc"}),s()},children:"Ascending"}),t(M,{onClick:()=>{l.mutate({tableId:e.table.id,order:"desc"}),s()},children:"Descending"})]})]})}function ft(){const{setSuccessMessage:e}=_();return W(i=>I.delete(h.BigDecisions.decisionTable+"/"+i.id).then(n=>n.data),{onSuccess:(i,n)=>{const o=f.getQueryData(h.BigDecisions.decision),s=$(o,l=>{const r=o.findIndex(c=>c.id===n.decisionId),u=o[r].tables.findIndex(c=>c.id===n.id);return l[r].tables.splice(u,1),l});f.setQueryData(h.BigDecisions.decision,s),e("Option deleted!")}})}function bt(e){const i=pt(),{openConfirmDialog:n}=T(),[o,s]=g.exports.useState(null),l=a=>{s(a.currentTarget)},r=()=>{s(null)},u=ft(),{openDecisionTableDialog:c}=T();return d(m,{children:[t(R,{id:"decision-table-more-icon",size:"small","aria-label":"decision-table-more-icon",onClick:a=>{a.preventDefault(),l(a)},children:t(oe,{})}),d(F,{id:"decision-table-more-menu",anchorEl:o,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,open:Boolean(o),onClose:a=>{r()},children:[d(M,{onClick:a=>{a.preventDefault(),c(e.table),r()},children:[t(E,{className:i.listItemIcon,children:t(fe,{fontSize:"small"})}),t(B,{variant:"inherit",noWrap:!0,children:"Edit"})]}),d(M,{onClick:a=>{a.preventDefault(),n({title:"Confirm delete?",onConfirm:()=>{u.mutate(e.table)}})},id:"delete-decision-table-button",children:[t(E,{className:i.listItemIcon,children:t(se,{fontSize:"small"})}),t(B,{variant:"inherit",noWrap:!0,children:"Delete"})]})]})]})}const pt=N(e=>ne({listItemIcon:{width:16}})),Dt=({table:e,isWinner:i})=>{const n=xt(),o=ot(e.decisionId),{sidebarIsOpen:s}=A(),l=()=>{o.mutate(st(e.id))},r=c=>{o.mutate(c)},u=()=>s?240:180;return d(m,{mr:2,mt:4,children:[d(y,{justifyContent:"space-between",children:[t(y,{maxWidth:s?470:392,children:d(re,{variant:"h5",children:[e.title," \xB7 ",C(e.items),i&&t(Pe,{size:"sm",icon:ke,style:{color:"orange",marginLeft:8,marginBottom:2}})]})}),t(m,{children:t(bt,{table:e})})]}),t(m,{mt:1}),d(ze,{children:[t(Ne,{className:n.container,children:d(Re,{stickyHeader:!0,size:"small",className:n.table,children:[t(Ke,{className:n.tableHead,children:d(pe,{children:[t(w,{width:u(),children:"Problem / Risk"}),t(w,{width:u(),children:"Solution / Counter argument"}),d(w,{className:n.col3,children:[t(m,{children:"Weight"}),d(y,{justifyContent:"center",children:[C(e.items)>0?t("b",{style:{color:De.ratingYellow[5]},children:C(e.items)}):C(e.items),t(gt,{table:e})]})]})]})}),t(Ue,{children:e.items.map(c=>t(rt,{initialItem:c,onThrottledChange:r,biggerColsWidth:u()},`${c.id}-${c.updatedAt}`))})]})}),t(Ee,{disableGutters:!0,variant:"dense",onClick:l,className:n.footer,children:d(y,{ml:2,children:[t(q,{}),t(m,{ml:1,children:"Add problem"})]})})]})]},e.id)},xt=N(e=>({container:{maxHeight:440},table:{"& .MuiTableCell-root":{padding:8,borderBottom:"1px solid rgb(255 255 255 / 0.1)"}},lastRow:{cursor:"pointer","& .MuiTableCell-root":{borderBottom:"none"}},tableHead:{"& .MuiTableCell-root":{backgroundColor:"#2B2B2B"}},col3:{width:60,textAlign:"center"},footer:{"&:hover":{background:e.palette.grey[800],cursor:"pointer",borderRadius:"inherit"}}})),St=e=>{const{data:i}=J(),n=i==null?void 0:i.find(r=>r.id===e.decisionId),o=()=>[...n.tables].sort((r,u)=>r.index-u.index),s=n?L(o()):null,{openDecisionTableDialog:l}=T();return n?d(Oe,{children:[d(z,{justifyContent:"space-between",children:[t(B,{variant:"h4",children:n.title}),t(xe,{decision:n})]}),t(z,{mt:4,children:t(_e,{onClick:()=>l(tt(e.decisionId)),startIcon:t(q,{}),variant:"contained",color:"primary",children:"Add table"})}),t(z,{flexWrap:"wrap",children:o().map(r=>t(Dt,{table:r,isWinner:(s==null?void 0:s.id)===r.id},r.id))})]}):null};function ye(){return W(e=>I.post(h.BigDecisions.decision,e).then(i=>i.data),{onSuccess:e=>{const i=f.getQueryData(h.BigDecisions.decision),n=$(i,o=>{const s=i.findIndex(l=>l.id===e.id);return~s?o[s]=e:o=[e,...i],o});f.setQueryData(h.BigDecisions.decision,n)}})}const yt=e=>{const i=ae(),{setSuccessMessage:n}=_(),o=()=>{e.onClose()},{mutate:s}=ye(),l=x=>{s(x,{onSuccess:S=>{n("Decision saved!"),o(),i.push(G.BigDecisions.decision(S.id))}})},{handleSubmit:r,formState:{isSubmitting:u},control:c,watch:a,reset:b}=le({defaultValues:e.initialValue});return g.exports.useEffect(()=>{e.open&&b(e.initialValue)},[e.open]),t(ce,{onClose:o,open:e.open,fullWidth:!0,maxWidth:"xs","aria-labelledby":"decision-dialog",children:t(m,{pb:1,px:1,children:d("form",{onSubmit:r(l),children:[t(O,{id:"decision-dialog-title",children:a("id")?"Edit Decision":"New Decision"}),t(de,{children:t(m,{children:t(ue,{control:c,name:"title",render:({field:x})=>t(j,D({id:"title",name:"title",size:"small",label:"Title",fullWidth:!0,required:!0,autoFocus:!0},x))})})}),t(O,{children:t(he,{disabled:u,onCancel:o})})]})})})};var K={},It=V.exports,vt=H.exports;Object.defineProperty(K,"__esModule",{value:!0});var Ie=K.default=void 0,Ct=vt(g.exports),wt=It(Q),Tt=(0,wt.default)(Ct.createElement("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"}),"Search");Ie=K.default=Tt;const Mt=()=>({id:null,userId:null,title:"",isPriority:!0});var U={},Bt=V.exports,Wt=H.exports;Object.defineProperty(U,"__esModule",{value:!0});var ve=U.default=void 0,Pt=Wt(g.exports),kt=Bt(Q),zt=(0,kt.default)(Pt.createElement("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star");ve=U.default=zt;const Nt=e=>{const i=Rt();return t($e,{title:e.tooltipText,enterDelay:500,enterNextDelay:500,children:t(R,{size:"small",onClick:e.onClick,children:t(ve,{className:Ae({[i.isNotPriority]:!e.isPriority,[i.isPriority]:e.isPriority})})})})},Rt=N(e=>({nameTextField:{background:"transparent"},nameInput:{fontSize:24},isNotPriority:{color:e.palette.grey[400]},isPriority:{color:"#ffb400"}})),Et=({decision:e,isSelected:i})=>{const n=g.exports.useRef(null),o=ye(),s=u=>{const c=be(u,a=>{a.isPriority=!u.isPriority});o.mutate(c)},[l,r]=g.exports.useState(!1);return d(me,{ref:n,button:!0,component:Le,to:G.BigDecisions.decision(e.id),selected:i,disableGutters:!0,style:{paddingLeft:16,paddingRight:16},onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[t(ge,{children:d(z,{children:[t(y,{children:t(Nt,{isPriority:e.isPriority,tooltipText:"Priority decision",onClick:()=>{s(e)}})}),d(m,{ml:2,mt:.5,width:180,children:[t(B,{children:t("strong",{children:e.title})}),L(e.tables)&&t(m,{mt:1,children:t(re,{variant:"body2",children:L(e.tables).title})})]})]})}),l&&t(xe,{decision:e})]},e.id)},Ot=e=>{var u;const[i,n]=g.exports.useState(""),{openDecisionDialog:o}=T(),{data:s,isLoading:l}=J(),r=()=>{if(!s)return[];const c=s.sort((a,b)=>a.isPriority&&!b.isPriority?-1:1);return i.length?c.filter(a=>qe(a.title,i)):c};return t(Xe,{children:d(m,{children:[t(m,{pt:4,px:2,children:t(j,{fullWidth:!0,style:{marginLeft:"auto",marginRight:"auto"},label:d(y,{children:[t(Ie,{style:{fontSize:"0.95rem"}}),t(m,{ml:.5,children:"Filter Decisions"})]}),value:i,onChange:c=>n(c.target.value)})}),t(Fe,{disablePadding:!0,children:l?t(Qe,{mt:2,children:t(Ve,{})}):d(He.Fragment,{children:[t(me,{children:t(ge,{children:d(y,{justifyContent:"space-between",children:[d(m,{children:[(u=r())==null?void 0:u.length," decisions"]}),t(R,{size:"small",onClick:()=>o(Mt()),children:t(q,{})})]})})}),r().map(c=>t(Et,{decision:c,isSelected:e.selectedDecisionId===c.id},c.id))]})})]})})},ie={DecisionsPageRoot:je(z)(({theme:e})=>({padding:e.spacing(2),height:"100%"})),ContentWrapper:Ge(m)(e=>({flexGrow:1,marginLeft:e.$sidebarIsOpen?300:0,transition:k.transitions.create("margin",{easing:e.$sidebarIsOpen?k.transitions.easing.easeOut:k.transitions.easing.easeIn,duration:e.$sidebarIsOpen?k.transitions.duration.leavingScreen:k.transitions.duration.enteringScreen})}))};function _t(){const{setSuccessMessage:e,setErrorMessage:i}=_();return W(n=>I.post(h.BigDecisions.decisionTable,n).then(o=>o.data),{onSuccess:n=>{const o=f.getQueryData(h.BigDecisions.decision),s=$(o,l=>{const r=o.findIndex(u=>u.id===n.id);return l[r]=n,l});f.setQueryData(h.BigDecisions.decision,s),e("Table saved!")},onError:n=>{i("Error while saving table: "+JSON.stringify(n))}})}const $t=e=>{const i=()=>{e.onClose()},{mutate:n}=_t(),o=a=>{n(a,{onSuccess:b=>{i()}})},{handleSubmit:s,formState:{isSubmitting:l},control:r,watch:u,reset:c}=le({defaultValues:e.initialValue});return g.exports.useEffect(()=>{e.open&&c(e.initialValue)},[e.open]),t(ce,{onClose:i,open:e.open,fullWidth:!0,maxWidth:"xs","aria-labelledby":"decision-table-dialog",children:t(m,{pb:1,px:1,children:d("form",{onSubmit:s(o),children:[t(O,{id:"decision-table-dialog-title",children:u("id")?"Edit Table":"New Table"}),t(de,{children:t(m,{children:t(ue,{control:r,name:"title",render:({field:a})=>t(j,D({id:"title",size:"small",label:"Title",fullWidth:!0,required:!0,autoFocus:!0,onCtrlEnter:s(o),multiline:!0},a))})})}),t(O,{children:t(he,{disabled:l,onCancel:i})})]})})})},Gt=()=>{const{id:e}=Je(),{openSidebar:i}=A(),n=Ze(e)?Number(e):null;g.exports.useEffect(()=>{document.title=Ye.decisions,i()},[]);const{data:o}=J(),s=ae();g.exports.useEffect(()=>{n===null&&(o==null?void 0:o.length)&&s.push(G.BigDecisions.decision(o[0].id))},[o]);const{decisionDialogOpen:l,decisionDialogValue:r,closeDecisionDialog:u,decisionTableDialogOpen:c,decisionTableDialogValue:a,closeDecisionTableDialog:b}=T(),{sidebarIsOpen:x}=A();return d(ie.DecisionsPageRoot,{children:[t(Ot,{selectedDecisionId:n}),t(ie.ContentWrapper,{$sidebarIsOpen:x,children:e&&t(St,{decisionId:n})}),t(yt,{initialValue:r,open:l,onClose:u}),t($t,{initialValue:a,open:c,onClose:b})]})};export{Gt as default};
